/**
 * kTip 0.0.12
 * Based on mgExternal 1.0.30
 *
 * Copyright 2012 Ricard Osorio Ma√±anas
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
(function(d,s,x){d.fn.kTip=function(a,c){var b,e=0;this.each(function(){d(this).data("kTip")?b=d(this).data("kTip"):(e++,d(this).data("kTip",kTip(this,a,c)))});return!b||1<e?this:b};d.expr[":"].kTip=function(a){return!!d(a).data("kTip")};d.kTip=s.kTip=function(a,c,b){if(!(this instanceof kTip))return new kTip(a,c,b);if(!a||!a.nodeType)b=c,c=a,a=null;"object"==typeof c&&(b=c,c=null);b=d.extend(!0,{},this.defaults,b,d(a).data("ktipOptions"));this.settings={display:"tooltip",auto:!a,renew:!0,autoFocus:!0,outsideClose:!0,escClose:!0,destroyOnClose:!a,css:{},extraClass:b&&b.display?"kT-"+b.display:"kT-tooltip",activeClass:"active",loadingClass:"loading",disabledClass:"disabled",showDelay:b&&b.tooltip&&"hover"==b.tooltip.bind?200:0,hideDelay:b&&b.tooltip&&"hover"==b.tooltip.bind?200:0,showSpeed:300,hideSpeed:300,overlay:b&&"modal"==b.display?!0:!1,overlayColor:"#fff",overlayOpacity:0.7,overlayShowSpeed:300,overlayHideSpeed:300,submitIdentifier:'input[type="submit"]',focusPriority:["[autofocus]:visible:enabled:first",":input:not(:radio):visible:enabled:first"],zIndexContainer:999,zIndexTooltipTrigger:998,zIndexOverlay:997,breatheSeparation:b&&"modal"==b.display?30:0,ajax:{url:x,data:{},handleForms:!0},modal:{animateSpeed:500,onDisableScroll:function(){},onRestoreScroll:function(){}},tooltip:{bind:"click",position:"top center",positionSource:d(a),distance:0,arrowSize:8,arrowDistance:15,arrowFrontColor:x,fit:!0},onCreateElements:function(){},onBeforeShow:function(){},onShow:function(){},onBeforeClose:function(){},onClose:function(){},onDestroy:function(){},onContentReady:function(){},onStartLoading:function(){},onStopLoading:function(){},onFailedRequest:function(){alert("Please implement onFailedRequest to manage failed ajax requests.")},onJsonData:function(){alert("Please implement onJsonData to manage ajax JSON responses.")}};d.extend(!0,this.settings,b);this.$trigger=d(a);this.$tooltipArrow=this.$overlay=this.$content=this.$container=null;this._defaultContent=c;this._defaultAjaxUrl=this.settings.ajax.url;this._lastSubmitName=null;this._show=!1;this._triggerZIndexBackup=null;this._preventNextMouseup=!1;this._moveTimeout=null;this._registeredChildren=[];this._lastMousedownOutside;if(this.$trigger){var e=this;switch(this.settings.display){case "modal":this.$trigger.bind("click",function(a){e.open(e.settings.showDelay);a.preventDefault()});break;case "tooltip":switch(this.settings.tooltip.bind){case "click":this.$trigger.bind("click",function(a){e.isVisible()?e.close():e.open(e.settings.showDelay);a.preventDefault()});break;case "hover":this.$trigger.bind({mouseenter:function(){e.open(e.settings.showDelay)},mouseleave:function(){e.close(e.settings.hideDelay)},mousedown:function(a){a.stopPropagation()},mouseup:function(a){a.stopPropagation()}});break;case "focus":this.$trigger.bind({focus:function(){e.open(e.settings.showDelay)},blur:function(){e.close(e.settings.hideDelay)},mousedown:function(a){a.stopPropagation()},mouseup:function(a){a.stopPropagation()}})}}}this.settings.auto&&this.open()};kTip.prototype={defaults:{},_browserScrollbarWidth:17,registerChild:function(a){this._registeredChildren.push(a)},isVisible:function(){return!!this.$container&&this.$container.is(":visible")},areAllChildrenClosed:function(){var a=!0;this.$content.find(":kTip").each(function(){d(this).kTip().isVisible()&&(a=!1)});return a},open:function(a){var c=this;this._show=!0;a?setTimeout(function(){c._open()},a):this._open()},_open:function(){if(this._show&&!this.isVisible())if(this.settings.renew||!this.$container){this.settings.ajax.url=this._defaultAjaxUrl;this._lastSubmitName=null;var a=this.settings.ajax.url||this.$trigger.attr("href");if(this._defaultContent)this.setContent(this._defaultContent);else if(a)a.match(/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i)?this.setContent('<img src="'+a+'" style="display:block;" />'):this.loadAjaxContent(a);else throw"kTip: no defaultContent or settings.ajax.url provided.";}else this.isVisible()||this.showContainer()},close:function(a){var c=this;this._show=!1;a?setTimeout(function(){c._close()},a):this._close()},_close:function(){if(!this._show&&this.isVisible()&&!1!==this.settings.onBeforeClose.call(this)){var a=this;this.$trigger.removeClass(this.settings.loadingClass).removeClass(this.settings.activeClass);this.settings.onStopLoading.call(this);this.$container.fadeOut(this.settings.hideSpeed,function(){a.settings.destroyOnClose&&a.destroy();"modal"==a.settings.display&&a.settings.overlay?(a.$container.parent().hide(),d("body").css({marginRight:"",overflow:""}),a.settings.modal.onRestoreScroll.call(a),a.$overlay.fadeOut(a.settings.overlayHideSpeed,function(){a.settings.onClose.call(a)})):a.settings.onClose.call(a)});"tooltip"==this.settings.display&&this.settings.overlay&&this.$overlay.fadeOut(this.settings.overlayHideSpeed,function(){a.$trigger.css({position:a._triggerZIndexBackup.position,zIndex:a._triggerZIndexBackup.zIndex})});this.$content.find(":kTip").each(function(){d(this).kTip().close()})}},setContent:function(a,c){this.$container||this.createElements();"modal"==this.settings.display&&(c=c||{type:"resize"},c.$preContent=this.$content.clone(!1),c.preHeight=this.$content.height(),c.preWidth=this.$content.width());var b=this.$content.clone();b.appendTo(this.$container);this.$content.html(a).css({visibility:"hidden"}).appendTo("body");this.bindSpecialActions();this.settings.onContentReady.call(this);this.$content.css({visibility:""});this.$content.appendTo(this.$container);b.remove();if(this.isVisible()&&1==this.$container.css("opacity"))return this.setFocus(),this.moveContainer(c,!0);this.showContainer()},showContainer:function(){if(!1!==this.settings.onBeforeShow.call(this)){var a=this;this.$trigger.addClass(this.settings.activeClass);"tooltip"==this.settings.display&&this.settings.overlay&&(this._triggerZIndexBackup={position:"static"==this.$trigger.css("position")?"":this.$trigger.css("position"),zIndex:0==this.$trigger.css("z-index")?"":this.$trigger.css("z-index")},this.$trigger.css({position:this._triggerZIndexBackup.position?null:"relative",zIndex:this.settings.zIndexTooltipTrigger}));var c=function(){"modal"==a.settings.display&&a.settings.overlay&&a.$container.parent().show();a.$container.css("visibility","hidden").show();a.moveContainer({type:"instant"});a.$container.hide().css("visibility","");a.$container.fadeIn(a.settings.showSpeed,function(){a.setFocus();a.settings.onShow.call(a)})};this.settings.overlay?"modal"==this.settings.display?(d("body").css({marginRight:this._browserScrollbarWidth,overflow:"hidden"}),this.settings.modal.onDisableScroll.call(this),this.$overlay.fadeIn(this.settings.overlayShowSpeed,c)):(this.$overlay.fadeIn(this.settings.overlayShowSpeed),c()):c()}},destroy:function(){"modal"==this.settings.display&&this.settings.overlay?this.$container.parent().remove():this.$container.remove();this.settings.onDestroy.call(this);this.$trigger.removeData("kTip")},bindSpecialActions:function(){var a=this;this.settings.ajax.handleForms&&d.fn.ajaxSubmit&&this.$content.find("form").bind("submit",function(c){var b=d(this);c.preventDefault();a._lastSubmitName=b.find(a.settings.submitIdentifier).val();b.ajaxSubmit(d.extend(!0,{},a.settings.ajax,b.data("kTip-ajax"),{url:b.attr("action")||a.settings.ajax.url||a.$trigger.attr("href"),success:function(b){a.disableLoadingState();a.settings.onStopLoading.call(a);"object"==typeof b?a.settings.onJsonData.call(a,b):a.setContent(b)},error:function(b,c,d){a.settings.onFailedRequest.call(a,b,c,d)}}));a.setLoadingState()});this.$content.find('[class*="kTip-redirect"]').bind("click",function(c){var b=d(this);c.preventDefault();c={};"modal"==a.settings.display&&(c.type=b.is('[class*="redirect-fade"]')?"fade":b.is('[class*="redirect-move"]')?"move":b.is('[class*="redirect-instant"]')?"instant":"resize");a.redirect(b.attr("href"),c)});this.$content.find(".kTip-close").bind("click",function(c){a.close();c.preventDefault()})},redirect:function(a,c){this.settings.ajax.url=a;this.loadAjaxContent(a,c)},loadAjaxContent:function(a,c){var b=this;this.setLoadingState();this.settings.onStartLoading.call(this);d.ajax(d.extend(!0,{},b.settings.ajax,{type:"GET",url:a,success:function(a){b.disableLoadingState();b.settings.onStopLoading.call(b);"object"==typeof a?b.settings.onJsonData.call(b,a):b.setContent(a,c)},error:function(a,c,d){b.settings.onFailedRequest.call(b,a,c,d)}}))},setLoadingState:function(){this.$trigger&&this.$trigger.addClass(this.settings.loadingClass);this.$content&&(this.$content.find(":input").prop("disabled",!0),this.$content.find(":input, .kTip-loading-disabled").addClass(this.settings.disabledClass),this.$content.find(".kTip-loading").show())},disableLoadingState:function(){this.$trigger&&this.$trigger.removeClass(this.settings.loadingClass);this.$content&&(this.$content.find(":input").prop("disabled",!1),this.$content.find(":input, .kTip-loading-disabled").removeClass(this.settings.disabledClass),this.$content.find(".kTip-loading").hide())},setFocus:function(){if(this.settings.autoFocus){var a=this.$content.find(this.settings.submitIdentifier+'[value="'+this._lastSubmitName+'"]').parents("form:visible");0==a.length&&(a=this.$content.find("form:first:visible"));0==a.length&&(a=this.$content);for(var c=0,b=a.find(this.settings.focusPriority[c]);0==b.length&&c<=this.settings.focusPriority.length;b=a.find(this.settings.focusPriority[++c]));setTimeout(function(){b.trigger("focus")},10)}},createElements:function(){var a=this;this.$container||(this.$container=d("<div/>").data("kTip",this).addClass("kTip-container").addClass(this.settings.extraClass).css({position:"absolute",zIndex:this.settings.zIndexContainer}).hide().appendTo("modal"==this.settings.display&&this.settings.overlay?d("<div/>").data("kTip",this).css({height:"100%",left:0,overflowY:"scroll",position:"fixed",top:0,width:"100%",zIndex:this.settings.zIndexContainer}).appendTo("body"):"body").bind("mouseup",function(){a._preventNextMouseup=!0}),this.$content=d("<div/>").addClass("kTip-content").css(this.settings.css).appendTo(this.$container),"hover"==this.settings.tooltip.bind&&(this.$container.bind("mouseenter",function(){a.open(a.settings.showDelay)}),this.$container.bind("mouseleave",function(){a.close(a.settings.hideDelay)})),d(s).bind("resize",function(){a.moveContainer()}),"tooltip"==this.settings.display&&d(s).bind("scroll",function(){a.moveContainer()}),this.settings.outsideClose&&(d("body").on("mousedown",function(c){a._lastMousedownOutside=a.areAllChildrenClosed()&&!a.$container.is(c.target)&&!a.$container.find(c.target).length?!0:!1}),d("body").bind("mouseup",function(c){a._lastMousedownOutside&&(a._preventNextMousedown?a._preventNextMousedown=!1:1==c.which&&a.isVisible()&&a.close())})),this.settings.escClose&&d(document).bind("keyup",function(c){27==c.keyCode&&(a.isVisible()&&a.areAllChildrenClosed())&&a.close()}),a.settings.onCreateElements.call(a));this.settings.overlay&&!this.$overlay&&(this.$overlay=d("<div/>").data("kTip",this).attr("class","kTip-overlay").css({background:this.settings.overlayColor,height:"100%",left:0,opacity:this.settings.overlayOpacity,position:"fixed",top:0,width:"100%",zIndex:this.settings.zIndexOverlay}).hide().appendTo("body"));!this.$tooltipArrow&&("tooltip"==this.settings.display&&this.settings.tooltip.arrowSize)&&(this.$tooltipArrow=d("<div/>").addClass("kTip-arrow").css({position:"absolute"}).appendTo(this.$container).append(d("<div/>").addClass("kTip-arrow-shadow").css({borderStyle:"solid",borderWidth:this.settings.tooltip.arrowSize})).append(d("<div/>").addClass("kTip-arrow-front").css({borderColor:this.settings.tooltip.arrowFrontColor||this.$content.css("background-color"),borderStyle:"solid",borderWidth:this.settings.tooltip.arrowSize,position:"absolute"})))},moveContainer:function(a,c){if(this.isVisible()){this.$content.stop();a=a||{type:"resize"};if(!a.preHeight||!a.preWidth)a.preHeight=this.$content.height(),a.preWidth=this.$content.width();if(!this.settings.css.height||!this.settings.css.width)if(c||!this._moveTimeout){var b=this;this._moveTimeout=setTimeout(function(){b._moveTimeout=null},200);var d=this.$container.clone();d.css({left:0,top:0,visibility:"hidden"}).find(".kTip-content").css({height:this.settings.css.height||"",width:this.settings.css.width||""}).end().show().appendTo("body");this.$content.css({width:d.find(".kTip-content").width()});d.remove()}a.postHeight=this.$content.height();a.postWidth=this.$content.width();switch(this.settings.display){case "modal":this.moveModal(a);break;case "tooltip":this.moveTooltip()}}},moveModal:function(a){var c=this,b=0,e=0,q=this.settings.breatheSeparation;this.$container.css("padding",q+"px 0 "+2*q+"px");var q=this.$container.outerHeight(!0),k=this.$container.outerWidth(!0),f=d(s).height(),m=d(s).width(),l=this.settings.overlay?0:d(document).scrollTop();this.settings.overlay&&(k+=this._browserScrollbarWidth);q<f&&(b=l+(f-q)/2);b<l&&(b=l);e=(m-k)/2;0>e&&(e=0);switch(a.type){case "fade":this.$content.hide();this.$container.append(a.$preContent).fadeOut(this.settings.modal.animateSpeed,function(){a.$preContent.remove();c.$content.show();c.$container.css({top:b,left:e}).fadeIn(c.settings.modal.animateSpeed,function(){c.setFocus()})});break;case "move":this.$container.stop().animate({top:b,left:e,opacity:1},this.settings.modal.animateSpeed);break;case "instant":this.$container.stop().css({top:b,left:e,opacity:1});break;default:this.$content.css({height:a.preHeight,width:a.preWidth}).animate({height:a.postHeight,width:a.postWidth},this.settings.modal.animateSpeed,function(){c.$content.css("height",c.settings.css.height||"")}),this.$container.stop().animate({top:b,left:e,opacity:1},this.settings.modal.animateSpeed)}},moveTooltip:function(){var a,c,b,e,q,k,f={top:0,left:0},m=this.settings.breatheSeparation+this.settings.tooltip.arrowSize;q=d(s).height();var l=d(s).width(),n=this.$container.outerHeight(!0),p=this.$container.outerWidth(!0),v=this.settings.tooltip.positionSource,j=v.offset(),t=v.outerHeight(),u=v.outerWidth();a=this.settings.tooltip.distance;var g=this.settings.tooltip.arrowSize,r=this.settings.tooltip.arrowDistance,w=d(document).scrollTop();k=d(document).scrollLeft();var h=this.settings.tooltip.position.split(" ")[0];c=this.settings.tooltip.position.split(" ")[1];this.settings.tooltip.fit&&("bottom"==h&&q<j.top-w+t+n+m&&(h="top"),"top"==h&&j.top-w-m<n&&(h="bottom"),"right"==h&&l<j.left-k+u+p+m&&(h="left"),"left"==h&&j.left-k-m<p&&(h="right"));switch(h){case "top":f.top=j.top-n-a-g;break;case "bottom":f.top=j.top+t+a+g;break;case "left":f.left=j.left-p-a-g;break;case "right":f.left=j.left+u+a+g}switch(c){case "top":f.top=j.top;break;case "middle":f.top=j.top-n/2+t/2;break;case "bottom":f.top=j.top-n+t;break;case "left":f.left=j.left;break;case "center":f.left=j.left-p/2+u/2;break;case "right":f.left=j.left-p+u}if(this.settings.tooltip.fit){"left"==h||"right"==h?(a="top",c=t,b=j.top,e=n,k=w):(a="left",c=u,b=j.left,e=p,q=l);for(;f[a]-k+e+m>q;)if(l=!1,e>=c?f[a]+e>b+c&&(l=!0):f[a]>b&&(l=!0),l)f[a]--;else break;for(;f[a]-k<m;)if(l=!1,e>=c?f[a]<b&&(l=!0):f[a]+e<b+c&&(l=!0),l)f[a]++;else break;if(g&&c<g+2*r&&(m=b+c/2-g-f[a],k=f[a]+e-b-c/2-g,!(m<r&&k<r)&&(m<r&&(f[a]=b+c/2-g-r),k<r&&(f[a]=b-e+c/2+g+r),m=b+c/2-g-f[a],k=f[a]+e-b-c/2-g,m<r||k<r)))f[a]=b-(e-2*g)/2}g?(this.$tooltipArrow||this.createElements(),this.$tooltipArrow.show(),"top"==h||"bottom"==h?this.$tooltipArrow.css({bottom:"top"==h?-g:"",height:g,left:p<u?p/2-g:j.left-f.left+u/2-g,top:"top"==h?"":-g,width:2*g}).find("div").css({borderLeftColor:"transparent",borderRightColor:"transparent",borderBottomWidth:"top"==h?0:g,borderTopWidth:"bottom"==h?0:g}).filter(".kTip-arrow-front").css({left:0,top:("top"==h?"-":"")+this.$content.css("borderBottomWidth")}).end().filter(".kTip-arrow-shadow").css("border-"+h+"-color",this.$content.css("border-"+("top"==h?"bottom":"top")+"-color")):this.$tooltipArrow.css({bottom:"",height:2*g,left:"left"==h?"":-g,right:"right"==h?"":-g,top:n<t?n/2-g:j.top-f.top+t/2-g,width:g}).find("div").css({borderBottomColor:"transparent",borderTopColor:"transparent",borderLeftWidth:"right"==h?0:g,borderRightWidth:"left"==h?0:g}).filter(".kTip-arrow-front").css({left:("left"==h?"-":"")+this.$content.css("borderBottomWidth"),top:0}).end().filter(".kTip-arrow-shadow").css("border-"+h+"-color",this.$content.css("border-"+("left"==h?"right":"left")+"-color"))):this.$tooltipArrow&&this.$tooltipArrow.hide();if("bottom"==h){n=v;for(p=!1;!n.is("body");){if("fixed"==n.css("position")){p=!0;break}n=n.parent()}p?(f.position="fixed",f.top-=w):f.position="absolute"}this.$container.css(f)}};d(function(){var a=d("<div/>").css({height:100,overflow:"hidden",position:"absolute",width:100}).append(d("<div/>").css("height","100%")).appendTo("body");s.kTip.prototype._browserScrollbarWidth=a.find("> div").width()-a.css("overflow-y","scroll").find("> div").width();a.remove()})})(jQuery,window);